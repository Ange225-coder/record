{% extends 'base.html.twig' %}

{% block title %}Record | Accueil{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {#  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
{% endblock %}

{% block body %}
    <section>
        <h1>RECORD</h1>

        <a href="{{ path('home') }}">Hébergement</a>
    </section>

    {% if app.user %}
        <p>
            <i class="bi bi-bell"></i>
        </p>
    {% endif %}

    <p>
        <a href="{{ path('partner_home') }}">Ajouter votre établissement</a>
    </p>

    {% if app.user %}
        <div>
            <details>
                <summary>Votre compte</summary>

                <div>
                    <p>
                        <a href="#">Gérer mon compte</a>
                    </p>

                    <p>
                        <a href="#">Reservation et voyage</a>
                    </p>

                    <p>
                        <a href="#">Portefeuille et recompense</a>
                    </p>

                    <p>
                        <a href="#">Commentaires</a>
                    </p>

                    <p>
                        <a href="#">Favoris</a>
                    </p>

                    <p>
                        <a href="{{ path('user_logout') }}" style="color: red;">Déconnexion</a>
                    </p>
                </div>

            </details>
        </div>
    {% endif %}


    {% if app.user is null %}
        <div>
            <p>
                <a href="{{ path('sign_up_email_form') }}">S'inscrire</a>
            </p>

            <p>
                <a href="{{ path('user_login') }}">Se connecter</a>
            </p>
        </div>
    {% endif %}

    <section>
        <h1>Trouvez votre prochain séjour</h1>

        {# research form #}
        <div>
            {{ form_start(searchingForm, {'attr' : {'novalidate' : 'novalidate'}}) }}
            <div style="display: flex;">
                <div>
                    {{ form_widget(searchingForm.town) }}
                    {{ form_errors(searchingForm.town) }}
                </div>

                <details>
                    <summary id="summary">Personne : . Enfant : </summary>
                    <div>
                        Adult : {{ form_widget(searchingForm.peopleCanStay) }}
                    </div>

                    <div>
                        Enfant : {{ form_widget(searchingForm.kidIsAccept) }}
                    </div>

                    <button id="finishBtn">Terminé</button>
                </details>

                <div>
                    <button type="submit">Rechercher</button>
                </div>
            </div>

            {{ form_end(searchingForm) }}
        </div>

        {# research result #}
        <div>
            {% if searchingForm.vars.submitted and searchingForm.vars.valid %}
                {% if housingGeneralInfo is not empty %}
                    {% if housingConfiguration is not empty %}
                        {#  <h2>{{ housingGeneralInfo|length }} Résultats pour la ville "{{ searchingForm.town.vars.value }}" :</h2> #}
                        <ul>
                            {#  {% for info in housingGeneralInfo %}
                                    <li>{{ info.housingName }} - {{ info.housingAddress }}</li>
                                {% endfor %}
                            #}
                        </ul>

                        <h2>{{ searchingForm.town.vars.value}} :  {{ housingConfiguration|length }} établissements trouvés</h2>

                        <ul>
                            {% for config in housingConfiguration %}
                                <li>{{ config.housingGeneralInfo.housingName }} - Capacité : {{ config.peopleCanStay }} - Enfants acceptés : {{ config.kidsIsAccept ? 'Oui' : 'Non' }} - id {{ config.id }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>Aucun appartement trouvé pour ce filtre</p>
                    {% endif %}
                {% else %}
                    <p>Aucune ville trouvée</p>
                {% endif %}
            {% endif %}

        </div>
    </section>

{% endblock %}


{% block javascripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('finishBtn').addEventListener('click', function(event) {
                event.preventDefault(); // Empêcher le rechargement de la page

                var peopleCanStay = document.getElementById('searches_housing_types_peopleCanStay').value;

                var kidIsAcceptElements = document.getElementsByName('searches_housing_types[kidIsAccept]');
                var kidIsAccept;
                for (var i = 0; i < kidIsAcceptElements.length; i++) {
                    if (kidIsAcceptElements[i].checked) {
                        kidIsAccept = kidIsAcceptElements[i].value;
                        break;
                    }
                }

                var summaryText = `Personne : ${peopleCanStay}. Enfant : ${kidIsAccept}`;
                document.getElementById('summary').textContent = summaryText;
            });

            // Optionnel : intercepter la soumission du formulaire pour empêcher le rechargement de la page
            document.getElementById('finishBtn').addEventListener('submit', function(event) {
                event.preventDefault(); // Empêcher le rechargement de la page
                // Vous pouvez ajouter ici votre logique de traitement du formulaire via AJAX par exemple
            });
        });
    </script>
{% endblock %}